openapi: 3.0.0
info:
  title: Agent Management API
  version: 1.0.0
  description: API for managing agents, their templates, and call logs

paths:
  /user:
    get:
      summary: Get user details
      tags:
        - User
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        description: The ID of the user
                      firstName:
                        type: string
                        description: The first name of the user
                      lastName:
                        type: string
                        description: The last name of the user
                      userEmail:
                        type: string
                        description: The email of the user
                      authProvider:
                        type: string
                        description: The authentication provider of the user
                      isEmailVerified:
                        type: boolean
                        description: Whether the user's email is verified
                      organizationId:
                        type: string
                        description: The organization ID of the user

        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /organization:
    get:
      summary: Get organization details
      tags:
        - Organization
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        description: The organization ID
                      name:
                        type: string
                        description: The organization name
                      members:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              description: The member ID
                            userEmail:
                              type: string
                              description: The member email
                      subscription:
                        type: object
                        properties:
                          planId:
                            type: string
                            description: The subscription plan ID

        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /agent/template:
    get:
      summary: Get agent templates
      tags:
        - Agent Templates
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: The ID of the agent template
                        name:
                          type: string
                          description: The name of the agent template
                        description:
                          type: string
                          description: The description of the agent template
                        avatarUrl:
                          type: string
                          description: The avatar URL of the agent template
                        referenceUrl:
                          type: string
                          description: The docs url of the agent template
                        category:
                          type: string
                          description: The category of the agent template

        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /agent/from-template:
    post:
      summary: Create agent from template
      tags:
        - Agent Templates
      security:
        - BearerAuth: []
      description: We have created templates for some common use cases. You can use these templates to create an agent. For getting list of templates, you can use the /agent/template endpoint. It will give you the list of templates with their description and id. You can pass the id of the template in the request body to create an agent from the template.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAgentFromTemplateRequest"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: string
                    example: "60d0fe4f5311236168a109ca"
                    description: The ID of the created agent
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /agent:
    get:
      summary: Get all agents
      tags:
        - Agents
      security:
        - BearerAuth: []
      description: Agents are the main entities in the system. Agents are used to create conversations. You can create workflow for an agent and configure it for different use cases. You can also create custom workflows for an agent. This API will give you the list of agents created by organization you are a part of.
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
            description: Page number
        - in: query
          name: offset
          schema:
            type: integer
            default: 10
            description: Number of items to return per page
        - in: query
          name: search
          schema:
            type: string
            description: Search query
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      agents:
                        type: array
                        items:
                          $ref: "#/components/schemas/AgentDTO"
                      total:
                        type: number
                        description: Total number of agents

        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    post:
      summary: Create a new agent
      tags:
        - Agents
      security:
        - BearerAuth: []
      description: You can create a new agent by passing the name of the agent in the request body. You can use update-workflow endpoint next to assign custom workflow to the agent.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAgentRequest"
      responses:
        "201":
          description: Agent created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: string
                    example: "60d0fe4f5311236168a109ca"
                    description: The ID of the created agent

        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /agent/{id}:
    get:
      summary: Get agent by ID
      description: Agents are the main entities in the system. Agents are used to create conversations. You can create workflow for an agent and configure it for different use cases. You can also create custom workflows for an agent.
      tags:
        - Agents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/AgentDTO"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    patch:
      summary: Update an agent
      tags:
        - Agents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                language:
                  type: object
                  description: Language configuration for the agent. You can enable or disable language switching for the agent. This will be used to determine the language of the agent.
                  properties:
                    enabled:
                      type: string
                      enum: [en, hi, ta]
                      description: "The language of the agent. Supported: 'en' (English), 'hi' (Hindi), 'ta' (Tamil)."
                      default: en
                    switching:
                      type: object
                      description: Language switching configuration for the agent. If enabled, the agent will be able to switch between languages based on the user's language.
                      properties:
                        isEnabled:
                          type: boolean
                          description: Whether to enable language switching for the agent
                          default: false
                        minWordsForDetection:
                          type: number
                          minimum: 1
                          maximum: 10
                          description: Minimum number of words required for language detection
                          default: 2
                        strongSignalThreshold:
                          type: number
                          minimum: 0.1
                          maximum: 0.9
                          description: Threshold for strong language signal detection (0.1 to 0.9)
                          default: 0.7
                        weakSignalThreshold:
                          type: number
                          minimum: 0.1
                          maximum: 0.9
                          description: Threshold for weak language signal detection (0.1 to 0.9)
                          default: 0.3
                        minConsecutiveForWeakThresholdSwitch:
                          type: number
                          minimum: 1
                          maximum: 5
                          description: Minimum consecutive detections required for weak threshold language switch
                          default: 2
                synthesizer:
                  type: object
                  description: Synthesizer configuration for the agent. You can configure the synthesizer to use different voices and models. Currently we support 3 types of models for the synthesizer. Waves, Waves Lightning Large and Waves Lightning Large Voice Clone. You can clone your voice using waves platform https://waves.smallest.ai/voice-clone and use the voiceId for this field and select the model as waves_lightning_large_voice_clone to use your cloned voice. When updating the synthesizer configuration to voice clone model, you have to provide model and voiceId and gender all are required fields but when selecting the model as waves or waves and waves_lightning_large, you have to provide only model field and voiceId.
                  properties:
                    voiceConfig:
                      oneOf:
                        - type: object
                          properties:
                            model:
                              type: string
                              enum: [waves_lightning_large_voice_clone]
                              description: We currently support 3 types of models for the synthesizer. Waves, Waves Lightning Large and Waves Lightning Large Voice Clone. You can clone your voice using waves platform and use the voiceId for this field and select the model as waves_lightning_large_voice_clone to use your cloned voice.
                            voiceId:
                              type: string
                            gender:
                              type: string
                              enum:
                                - male
                                - female
                              description: The gender of the synthesizer. When selecting gender, you have to select the model and voiceId which are required fields.
                        - type: object
                          properties:
                            model:
                              type: string
                              enum: [waves, waves_lightning_large]
                              description: We currently support 3 types of models for the synthesizer. Waves, Waves Lightning Large and Waves Lightning Large Voice Clone. You can clone your voice using waves platform and use the voiceId for this field and select the model as waves_lightning_large_voice_clone to use your cloned voice.
                            voiceId:
                              type: string
                              default: nyah
                              description: The voice ID to use
                      default:
                        model: waves_lightning_large
                        voiceId: nyah
                    speed:
                      type: number
                      default: 1.2
                    consistency:
                      type: number
                      minimum: 0
                      maximum: 1
                      default: 0.5
                    similarity:
                      type: number
                      minimum: 0
                      maximum: 1
                      default: 0
                    enhancement:
                      type: number
                      enum: [0, 1, 2]
                      default: 1
                globalKnowledgeBaseId:
                  type: string
                slmModel:
                  type: string
                  enum: ["electron", "gpt-4o"]
                  default: "electron"
                defaultVariables:
                  type: object
                  description: The default variables to use for the agent. These variables will be used if no variables are provided when initiating a conversation with the agent.
                globalPrompt:
                  type: string
                  description: |
                    Set global instructions for your agent's personality, role, and behavior throughout conversations. 
                    Note: Only used for workflow_graph agents.
                telephonyProductId:
                  type: string
                  description: The telephony product ID of the agent. This is the product ID of the telephony product that will be used to make the outbound call. You can buy telephone number and assign it to the agent.
      responses:
        "200":
          description: Agent updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: string
                    example: "60d0fe4f5311236168a109ca"
                    description: The ID of the updated agent
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    delete:
      summary: Delete an agent
      tags:
        - Agents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Agent deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"

  /agent/{id}/workflow:
    get:
      summary: Get agent workflow
      description: Retrieve the workflow configuration for a specific agent. The workflow contains nodes and edges that define the conversation flow and logic for the agent.
      tags:
        - Agents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the agent
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    description: The workflow configuration with type and data structure
                    properties:
                      type:
                        $ref: "#/components/schemas/WorkflowType"
                        description: The type of workflow (workflow_graph or single_prompt)
                      data:
                        oneOf:
                          - $ref: "#/components/schemas/WorkflowGraphData"
                          - $ref: "#/components/schemas/SinglePromptData"
                        description: The workflow configuration data. Structure depends on the workflow type - WorkflowGraphData for workflow_graph type, SinglePromptData for single_prompt type.
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "404":
          description: Agent or workflow not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Agent not found", "Workflow not found for this agent"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /workflow/{id}:
    patch:
      summary: Update workflow configuration
      description: Update workflow configuration for an agent. Currently available for single_prompt workflows only. For workflow_graph configurations, please use the UI.
      tags:
        - Workflows
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the workflow to update
          schema:
            type: string
            example: "60d0fe4f5311236168a109ca"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  $ref: "#/components/schemas/WorkflowType"
                  description: The type of workflow (single_prompt or workflow_graph)
                workflowGraph:
                  type: object
                  description: Workflow graph configuration. Required when type is workflow_graph. Exactly one of workflowGraph or singlePromptConfig must be provided.
                  properties:
                    nodes:
                      type: array
                      items:
                        type: object
                      description: Array of workflow nodes
                    edges:
                      type: array
                      items:
                        type: object
                      description: Array of workflow edges
                singlePromptConfig:
                  $ref: "#/components/schemas/SinglePromptConfig"
                  description: Configuration for single_prompt workflow type. Required when type is single_prompt. Exactly one of workflowGraph or singlePromptConfig must be provided.
              required:
                - type
      responses:
        "200":
          description: Workflow updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: string
                    description: Success message
                    example: "Workflow updated successfully"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "404":
          description: Workflow not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Workflow not found"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /conversation:
    get:
      summary: Get all conversation logs
      description: Retrieve paginated conversation logs with support for various filters. Returns call logs for agents belonging to the authenticated user's organization.
      tags:
        - Logs
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number for pagination
          example: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 5
            minimum: 1
          description: Number of items per page
          example: 10
        - in: query
          name: agentIds
          schema:
            type: string
          description: Comma-separated list of agent IDs to filter by
          example: "60d0fe4f5311236168a109ca,60d0fe4f5311236168a109cb"
        - in: query
          name: campaignIds
          schema:
            type: string
          description: Comma-separated list of campaign IDs to filter by
          example: "60d0fe4f5311236168a109ca,60d0fe4f5311236168a109cb"
        - in: query
          name: callTypes
          schema:
            type: string
            enum:
              - telephony_inbound
              - telephony_outbound
              - chat
          description: Comma-separated list of call types to filter by
          example: "telephony_outbound,telephony_inbound"
        - in: query
          name: search
          schema:
            type: string
          description: Search query to filter by callId, fromNumber, or toNumber
          example: "+1234567890"
        - in: query
          name: statusFilter
          schema:
            type: string
          description: |
            Comma-separated list of call statuses to filter by.
            Available statuses: pending, in_progress, completed, failed, no_answer, cancelled, busy
          example: "completed,failed"
        - in: query
          name: disconnectReasonFilter
          schema:
            type: string
          description: |
            Comma-separated list of disconnect reasons to filter by.
            Available reasons: user_hangup, agent_hangup, connection_error, timeout, system_error, transfer_complete
          example: "user_hangup,agent_hangup"
        - in: query
          name: callAttemptFilter
          schema:
            type: string
          description: |
            Comma-separated list of call attempt types to filter by.
            Available filters: initial (first attempt calls), retry (retry attempt calls), all (all calls)
          example: "initial"
        - in: query
          name: durationFilter
          schema:
            type: string
          description: |
            Comma-separated list of duration ranges to filter by.
            Available ranges: 0-30 (0-30 seconds), 30-60 (30-60 seconds), 1-5 (1-5 minutes), 5+ (more than 5 minutes)
          example: "0-30,30-60"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      logs:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              description: The database ID of the call log
                              example: "60d0fe4f5311236168a109ca"
                            callId:
                              type: string
                              description: The unique call identifier
                              example: "CALL-1737000000000-abc123"
                            status:
                              type: string
                              description: The status of the call
                              enum: [pending, in_progress, completed, failed, no_answer, cancelled, busy]
                              example: "completed"
                            duration:
                              type: number
                              description: The duration of the call in seconds
                              example: 120
                            from:
                              type: string
                              description: The phone number the call was made from
                              example: "+15551234567"
                            to:
                              type: string
                              description: The phone number the call was made to
                              example: "+15559876543"
                            type:
                              type: string
                              description: The type of call
                              enum: [telephony_inbound, telephony_outbound, chat]
                              example: "telephony_outbound"
                            agentId:
                              type: string
                              description: The ID of the agent that handled the call
                              example: "60d0fe4f5311236168a109ca"
                            agentName:
                              type: string
                              description: The name of the agent
                              example: "Sales Agent"
                            recordingUrl:
                              type: string
                              description: URL to the call recording (if available)
                              example: "https://storage.example.com/recordings/call-123.mp3"
                            recordingDualUrl:
                              type: string
                              description: URL to the dual-channel call recording (if available)
                              example: "https://storage.example.com/recordings/call-123-dual.mp3"
                            disconnectionReason:
                              type: string
                              description: The reason the call was disconnected
                              example: "user_hangup"
                            retryCount:
                              type: integer
                              description: Number of retry attempts for this call
                              example: 0
                            createdAt:
                              type: string
                              format: date-time
                              description: When the call was created
                              example: "2025-01-15T10:30:00.000Z"
                            dispositionMetrics:
                              type: object
                              description: Custom disposition metrics for the call
                              additionalProperties:
                                type: string
                              example:
                                interested: "yes"
                                follow_up_needed: "no"
                            agentDispositionConfig:
                              type: array
                              description: Configuration for disposition metrics
                              items:
                                type: object
                                properties:
                                  identifier:
                                    type: string
                                  type:
                                    type: string
                      pagination:
                        type: object
                        properties:
                          total:
                            type: integer
                            description: Total number of matching call logs
                            example: 150
                          page:
                            type: integer
                            description: Current page number
                            example: 1
                          limit:
                            type: integer
                            description: Number of items per page (page size)
                            example: 10
                          hasMore:
                            type: boolean
                            description: Whether there are more pages available
                            example: true
                          totalPages:
                            type: integer
                            description: Total number of pages
                            example: 15
                      dispositionMetricsConfig:
                        type: array
                        description: Global disposition metrics configuration
                        items:
                          type: object
                          properties:
                            identifier:
                              type: string
                            type:
                              type: string
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /conversation/search:
    post:
      summary: Search conversation logs by call IDs
      description: |
        Fetch specific conversation logs by their callIds. This endpoint allows you to retrieve up to 100 specific calls at once.
        Only returns calls that belong to agents in your organization (security check enforced).
        Unlike the GET /conversation endpoint, this endpoint can also return retry calls (non-root calls).
      tags:
        - Logs
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - callIds
              properties:
                callIds:
                  type: array
                  items:
                    type: string
                  minItems: 1
                  maxItems: 100
                  description: Array of callIds to fetch
                  example: ["CALL-1737000000000-abc123", "CALL-1737000000001-def456"]
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      logs:
                        type: array
                        items:
                          type: object
                          description: Call log details (same structure as GET /conversation)
                      total:
                        type: integer
                        description: Number of logs returned
                        example: 2
                      requestedCount:
                        type: integer
                        description: Number of callIds requested
                        example: 3
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /conversation/{id}:
    get:
      summary: Get conversation log by ID
      description: Retrieve detailed information about a specific conversation including transcript, events, and latency metrics.
      tags:
        - Logs
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The callId of the conversation. You can get the callId from the conversation logs endpoint.
          schema:
            type: string
          example: "CALL-1737000000000-abc123"
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        description: The ID of the conversation
                        example: "abc123"
                      callId:
                        type: string
                        description: The ID of the conversation
                        example: "abc123"
                      agent:
                        $ref: "#/components/schemas/AgentDTO"
                      status:
                        type: string
                        description: The status of the conversation
                        example: "completed"
                      duration:
                        type: number
                        description: The duration of the conversation in seconds
                        example: 300
                      recordingUrl:
                        type: string
                        description: The recording URL of the conversation
                      from:
                        type: string
                        description: The phone number of the caller
                      to:
                        type: string
                        description: The phone number of the callee
                      transcript:
                        type: array
                        description: The transcript of the conversation
                      average_transcriber_latency:
                        type: number
                        description: The average time taken by the TTS to transcribe the conversation
                      average_agent_latency:
                        type: number
                        description: The average time taken by the LLM to respond to the conversation
                      average_synthesizer_latency:
                        type: number
                        description: The average time taken by the TTS to synthesize the conversation
                      type:
                        type: string
                        description: The type of the conversation
                        enum:
                          - telephony_inbound
                          - telephony_outbound
                          - chat
                      voiceConfigUsed:
                        type: object
                        description: The voice configuration that was actually used for this call.
                        properties:
                          model:
                            type: string
                            description: The TTS model used for the call.
                          voiceId:
                            type: string
                            description: The voice ID used for the call.
                          gender:
                            type: string
                            description: The gender of the voice used for the call (e.g., "male", "female").
                      slmModelUsed:
                        type: string
                        description: The SLM/LLM model that was actually used for this call.
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /conversation/outbound:
    post:
      summary: Start an outbound call
      description: Initiates an outbound conversation with a specified agent and phone number.
      tags:
        - Calls
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                agentId:
                  type: string
                  description: The ID of the agent initiating the conversation
                  example: 60d0fe4f5311236168a109ca
                phoneNumber:
                  type: string
                  description: The phone number to call
                  example: "+1234567890"
                variables:
                  type: object
                  description: The variables to pass to the conversation
                  example: { "name": "John", "age": 30 }
                fromProductId:
                  type: string
                  description: The ID of the product to use for the call (get this from the /product/phone-numbers endpoint)
                  example: 60d0fe4f5311236168a109ca
              required:
                - agentId
                - phoneNumber
      responses:
        "200":
          description: Successfully started the outbound conversation
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      conversationId:
                        type: string
                        description: The ID of the initiated call
                        example: "CALL-XXXXX1234"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /campaign:
    get:
      summary: Retrieve all campaigns
      description: Get all campaigns
      tags:
        - Campaigns
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                page:
                  type: number
                  description: The page number
                  default: 1
                limit:
                  type: number
                  description: The number of items per page
                  default: 10
      responses:
        "200":
          description: A list of campaigns
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      campaigns:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              description: The unique identifier for the campaign
                            name:
                              type: string
                              description: The name of the campaign
                            description:
                              type: string
                              description: The description of the campaign
                            organization:
                              type: string
                              description: The ID of the organization
                            agentId:
                              type: string
                              description: The ID of the agent
                            createdBy:
                              type: string
                              description: The ID of the user who created the campaign
                            audienceId:
                              type: string
                              description: The ID of the audience
                            participantsCount:
                              type: integer
                              description: The number of participants in the campaign
                            createdAt:
                              type: string
                              format: date-time
                              description: The date and time when the campaign was created
                            updatedAt:
                              type: string
                              format: date-time
                              description: The date and time when the campaign was last updated
                            isCampaignInProgress:
                              type: boolean
                              description: Whether the campaign is in progress
                            isCampaignCompleted:
                              type: boolean
                              description: Whether the campaign is completed
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    post:
      summary: Create a campaign
      description: Create a campaign
      tags:
        - Campaigns
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: The name of the campaign
                  example: "My Campaign"
                description:
                  type: string
                  description: The description of the campaign
                  example: "This is a campaign to test the API"
                audienceId:
                  type: string
                  description: The ID of the audience
                  example: "60d0fe4f5311236168a109ca"
                agentId:
                  type: string
                  description: The ID of the agent
                  example: "60d0fe4f5311236168a109ca"
              required:
                - name
                - audienceId
                - agentId
      responses:
        "201":
          description: Campaign created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        description: The unique identifier for the campaign
                      name:
                        type: string
                        description: The name of the campaign
                      description:
                        type: string
                        description: The description of the campaign
                      organization:
                        type: string
                        description: The ID of the organization
                      agentId:
                        type: string
                        description: The ID of the agent
                      createdBy:
                        type: string
                        description: The ID of the user who created the campaign
                      audienceId:
                        type: string
                        description: The ID of the audience
                      participantsCount:
                        type: integer
                        description: The number of participants in the campaign
                      createdAt:
                        type: string
                        format: date-time
                        description: The date and time when the campaign was created
                      updatedAt:
                        type: string
                        format: date-time
                        description: The date and time when the campaign was last updated
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /campaign/{id}:
    get:
      summary: Get a campaign
      description: Get a campaign with detailed metrics
      tags:
        - Campaigns
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the campaign
          schema:
            type: string
      responses:
        "200":
          description: Campaign details with metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      campaign:
                        type: object
                        properties:
                          _id:
                            type: string
                            description: The unique identifier for the campaign
                          name:
                            type: string
                            description: The name of the campaign
                          description:
                            type: string
                            description: The description of the campaign
                          organization:
                            type: string
                            description: The ID of the organization
                          agentId:
                            type: string
                            description: The ID of the agent
                          createdBy:
                            type: string
                            description: The ID of the user who created the campaign
                          audienceId:
                            type: string
                            description: The ID of the audience
                          participantsCount:
                            type: integer
                            description: The number of participants in the campaign
                          status:
                            type: string
                            enum: [draft, scheduled, running, paused, scheduled_for_retry, completed]
                            description: The current status of the campaign
                          maxRetries:
                            type: integer
                            description: Maximum number of retry attempts
                            example: 3
                          retryDelay:
                            type: integer
                            description: Delay between retries in minutes
                            example: 15
                          scheduledAt:
                            type: string
                            format: date-time
                            description: Scheduled start time for the campaign
                          createdAt:
                            type: string
                            format: date-time
                            description: The date and time when the campaign was created
                          updatedAt:
                            type: string
                            format: date-time
                            description: The date and time when the campaign was last updated
                      events:
                        type: array
                        description: Campaign events history
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            campaignId:
                              type: string
                            triggerSource:
                              type: string
                            eventAction:
                              type: string
                            createdAt:
                              type: string
                              format: date-time
                      metrics:
                        type: object
                        description: Campaign performance metrics
                        properties:
                          total_participants:
                            type: integer
                            description: Total number of contacts in the campaign audience
                            example: 500
                          contacts_called:
                            type: integer
                            description: Number of unique contacts where call was attempted (statuses IN_PROGRESS, COMPLETED, FAILED, NO_ANSWER)
                            example: 247
                          contacts_connected:
                            type: integer
                            description: Number of unique contacts who answered and had a conversation (status COMPLETED)
                            example: 150
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    delete:
      summary: Delete a campaign
      description: Delete a campaign
      tags:
        - Campaigns
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the campaign
          schema:
            type: string
      responses:
        "200":
          description: Campaign deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /campaign/{id}/start:
    post:
      summary: Start a campaign
      description: Start a campaign
      tags:
        - Campaigns
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the campaign
          schema:
            type: string
      responses:
        "201":
          description: Campaign started successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /campaign/{id}/pause:
    post:
      summary: Pause a campaign
      description: Pause a campaign
      tags:
        - Campaigns
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the campaign
          schema:
            type: string
      responses:
        "200":
          description: Campaign paused successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /knowledgebase:
    get:
      summary: Get all knowledge bases
      description: Get all knowledge bases
      tags:
        - Knowledge Base
      security:
        - BearerAuth: []
      responses:
        "200":
          description: A list of knowledge bases
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/KnowledgeBase"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    post:
      summary: Create a knowledge base
      description: Create a knowledge base
      tags:
        - Knowledge Base
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
              required:
                - name
      responses:
        "201":
          description: Knowledge base created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: string
                    example: "60d0fe4f5311236168a109ca"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /knowledgebase/{id}:
    get:
      summary: Get a knowledge base
      description: Get a knowledge base
      tags:
        - Knowledge Base
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the knowledge base
          schema:
            type: string
      responses:
        "200":
          description: A knowledge base
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/KnowledgeBase"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    delete:
      summary: Delete a knowledge base
      description: Delete a knowledge base
      tags:
        - Knowledge Base
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the knowledge base
          schema:
            type: string
      responses:
        "200":
          description: Knowledge base deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /knowledgebase/{id}/items:
    get:
      summary: Get all knowledge base items
      description: Get all knowledge base items
      tags:
        - Knowledge Base
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the knowledge base
          schema:
            type: string
      responses:
        "200":
          description: A list of knowledge base items
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/KnowledgeBaseItem"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /knowledgebase/{knowledgeBaseId}/items/{knowledgeBaseItemId}:
    delete:
      summary: Delete a knowledge base item
      description: Delete a knowledge base item
      tags:
        - Knowledge Base
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: knowledgeBaseId
          required: true
          description: The ID of the knowledge base
          schema:
            type: string
        - in: path
          name: knowledgeBaseItemId
          required: true
          description: The ID of the knowledge base item
          schema:
            type: string
      responses:
        "200":
          description: Knowledge base item deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /knowledgebase/{id}/items/upload-media:
    post:
      summary: Upload a PDF file to a knowledge base
      description: Upload a PDF file to a knowledge base. Only PDF files are accepted.
      tags:
        - Knowledge Base
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the knowledge base
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                media:
                  type: string
                  format: binary
              required:
                - media
      responses:
        "201":
          description: Knowledge base item created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /product/phone-numbers:
    get:
      summary: Get acquired phone numbers
      description: Retrieve all acquired phone numbers for the organization
      tags:
        - Phone Numbers
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          description: The unique identifier for the phone number
                          example: "6867ca76d0f8f2e0f4201281"
                        isActive:
                          type: boolean
                          description: Whether the phone number is active
                          example: false
                        attributes:
                          type: object
                          description: Additional attributes of the phone number
                          properties:
                            provider:
                              type: string
                              description: The telephony provider
                              example: "twilio"
                            phoneNumber:
                              type: string
                              description: The actual phone number
                              example: "+13412184691"
                        createdAt:
                          type: string
                          format: date-time
                          description: The date and time when the phone number was created
                          example: "2025-07-04T12:35:02.821Z"
                        updatedAt:
                          type: string
                          format: date-time
                          description: The date and time when the phone number was last updated
                          example: "2025-07-07T08:11:35.327Z"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /webhook:
    get:
      summary: Get webhooks
      description: Retrieve all webhooks for the organization or a specific webhook by ID
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: webhookId
          schema:
            type: string
            description: Optional webhook ID to get a specific webhook
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    oneOf:
                      - $ref: "#/components/schemas/Webhook"
                      - type: array
                        items:
                          $ref: "#/components/schemas/Webhook"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    post:
      summary: Create a webhook
      description: Create a new webhook with subscriptions for specific agents and events
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                endpoint:
                  type: string
                  description: The webhook endpoint URL
                  example: "https://example.com/webhook"
                description:
                  type: string
                  description: The description of the webhook
                  example: "Webhook for conversation events"
                events:
                  type: array
                  description: Array of events to subscribe to
                  items:
                    type: object
                    properties:
                      agentId:
                        type: string
                        description: The ID of the agent
                        example: "60d0fe4f5311236168a109ca"
                      eventType:
                        type: string
                        enum: [pre-conversation, post-conversation]
                        description: The type of event to subscribe to
                        example: "post-conversation"
                  required:
                    - agentId
                    - eventType
              required:
                - endpoint
                - description
                - events
      responses:
        "201":
          description: Webhook created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: string
                    description: The ID of the created webhook
                    example: "60d0fe4f5311236168a109ca"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /webhook/{id}:
    delete:
      summary: Delete a webhook
      description: Delete a webhook by its ID
      tags:
        - Webhooks
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: The ID of the webhook to delete
          schema:
            type: string
      responses:
        "200":
          description: Webhook deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "404":
          description: Webhook not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Webhook not found"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /agent/{agentId}/webhook-subscriptions:
    get:
      summary: Get webhook subscriptions for an agent
      description: Retrieve webhook subscriptions for a given agent ID
      tags:
        - Agents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: agentId
          required: true
          description: The ID of the agent
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/WebhookSubscription"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "404":
          description: Agent not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Agent not found"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    post:
      summary: Create webhook subscriptions for an agent
      description: Create webhook subscriptions for a specific agent with selected event types
      tags:
        - Agents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: agentId
          required: true
          description: The ID of the agent to create subscriptions for
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                eventTypes:
                  type: array
                  description: Array of event types to subscribe to
                  items:
                    type: string
                    enum: [pre-conversation, post-conversation]
                    description: The type of event to subscribe to
                    example: "post-conversation"
                webhookId:
                  type: string
                  description: The ID of the webhook to subscribe to
                  example: "60d0fe4f5311236168a109ca"
              required:
                - eventTypes
                - webhookId
      responses:
        "201":
          description: Subscriptions created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: string
                    description: Success message
                    example: "Subscriptions created successfully"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                      [
                        "Agent already has webhook subscriptions. Please remove existing subscriptions before creating new ones.",
                      ]
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "404":
          description: Agent not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Agent not found"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
    delete:
      summary: Delete webhook subscriptions for an agent
      description: Delete webhook subscriptions for a given agent ID
      tags:
        - Agents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: agentId
          required: true
          description: The ID of the agent to filter subscriptions by
          schema:
            type: string
      responses:
        "200":
          description: Subscriptions deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: string
                    description: Success message
                    example: "Subscriptions deleted successfully"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "404":
          description: Agent not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Agent not found"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /audience:
    get:
      summary: Get all audiences
      description: Retrieve all audiences created by the authenticated user. Users can only access audiences they have created.
      tags:
        - Audience
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Successfully retrieved audiences
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          description: The unique identifier for the audience
                          example: "60d0fe4f5311236168a109ca"
                        name:
                          type: string
                          description: The name of the audience
                          example: "My Customer List"
                        description:
                          type: string
                          description: The description of the audience
                          example: "List of customers for marketing campaign"
                        phoneNumberColumnName:
                          type: string
                          description: The name of the column in the CSV that contains phone numbers
                          example: "phoneNumber"
                        organization:
                          type: string
                          description: The organization ID
                          example: "60d0fe4f5311236168a109cb"
                        createdBy:
                          type: string
                          description: The user ID who created the audience
                          example: "60d0fe4f5311236168a109cc"
                        createdAt:
                          type: string
                          format: date-time
                          description: The date and time when the audience was created
                          example: "2025-01-15T10:30:00.000Z"
                        updatedAt:
                          type: string
                          format: date-time
                          description: The date and time when the audience was last updated
                          example: "2025-01-15T10:30:00.000Z"
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

    post:
      summary: Create audience with CSV upload
      description: Create a new audience by uploading a CSV file containing phone numbers
      tags:
        - Audience
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: The name of the audience
                  example: "test_audience"
                description:
                  type: string
                  description: Optional description of the audience
                  example: "List of customers for marketing campaign"
                phoneNumberColumnName:
                  type: string
                  description: The name of the column in the CSV that contains phone numbers
                  example: "phoneNumber"
                identifierColumnName:
                  type: string
                  description: The name of the column in the CSV that contains identifiers (e.g., names)
                  example: "Name"
                file:
                  type: string
                  format: binary
                  description: CSV file containing phone numbers and identifiers (max 5MB)
                  example: "audience_template.csv"
              required:
                - name
                - phoneNumberColumnName
                - identifierColumnName
                - file

      responses:
        "200":
          description: Audience created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        description: The unique identifier for the audience
                        example: "60d0fe4f5311236168a109ca"
                      name:
                        type: string
                        description: The name of the audience
                        example: "My Customer List"
                      description:
                        type: string
                        description: The description of the audience
                        example: "List of customers for marketing campaign"
                      phoneNumberColumnName:
                        type: string
                        description: The name of the column in the CSV that contains phone numbers
                        example: "phoneNumber"
                      identifierColumnName:
                        type: string
                        description: The name of the column in the CSV that contains identifiers
                        example: "Name"
                      organization:
                        type: string
                        description: The organization ID
                        example: "60d0fe4f5311236168a109cb"
                      createdBy:
                        type: string
                        description: The user ID who created the audience
                        example: "60d0fe4f5311236168a109cc"
                      createdAt:
                        type: string
                        format: date-time
                        description: The date and time when the audience was created
                        example: "2025-01-15T10:30:00.000Z"
                      updatedAt:
                        type: string
                        format: date-time
                        description: The date and time when the audience was last updated
                        example: "2025-01-15T10:30:00.000Z"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                      [
                        "CSV file is required",
                        "Some phone numbers in your CSV already exist in this audience. Please remove duplicate entries and try again.",
                      ]
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /audience/{id}:
    get:
      summary: Get audience by ID
      description: Retrieve a specific audience by its ID. Users can only access audiences they have created.
      tags:
        - Audience
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the audience
          schema:
            type: string
            example: "60d0fe4f5311236168a109ca"
      responses:
        "200":
          description: Successfully retrieved audience
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        description: The unique identifier for the audience
                        example: "60d0fe4f5311236168a109ca"
                      name:
                        type: string
                        description: The name of the audience
                        example: "My Customer List"
                      description:
                        type: string
                        description: The description of the audience
                        example: "List of customers for marketing campaign"
                      phoneNumberColumnName:
                        type: string
                        description: The name of the column in the CSV that contains phone numbers
                        example: "phoneNumber"
                      organization:
                        type: string
                        description: The organization ID
                        example: "60d0fe4f5311236168a109cb"
                      createdBy:
                        type: string
                        description: The user ID who created the audience
                        example: "60d0fe4f5311236168a109cc"
                      createdAt:
                        type: string
                        format: date-time
                        description: The date and time when the audience was created
                        example: "2025-01-15T10:30:00.000Z"
                      updatedAt:
                        type: string
                        format: date-time
                        description: The date and time when the audience was last updated
                        example: "2025-01-15T10:30:00.000Z"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Audience ID missing"]
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "403":
          description: Forbidden - User can only access audiences they created
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Not authorized to view this audience"]
        "404":
          description: Audience not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Audience not found"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

    delete:
      summary: Delete audience
      description: Delete a specific audience by its ID. Users can only delete audiences they created. Cannot delete if audience is being used by a campaign.
      tags:
        - Audience
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the audience to delete
          schema:
            type: string
            example: "60d0fe4f5311236168a109ca"
      responses:
        "200":
          description: Audience deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: array
                    example: []
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                      ["cant delete audience, campaign with this audience 60d0fe4f5311236168a109ca exists"]
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /audience/{id}/members:
    get:
      summary: Get audience members
      description: Retrieve members of a specific audience with pagination support. Users can only access members of audiences they created.
      tags:
        - Audience
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the audience
          schema:
            type: string
            example: "60d0fe4f5311236168a109ca"
        - name: page
          in: query
          required: false
          description: Page number for pagination (default is 1)
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          required: false
          description: Number of items per page (default is 5)
          schema:
            type: integer
            minimum: 1
            default: 5
            example: 10
      responses:
        "200":
          description: Successfully retrieved audience members
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      members:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              description: The unique identifier for the audience member
                              example: "60d0fe4f5311236168a109cd"
                            data:
                              type: object
                              description: Dynamic data from CSV, structure depends on uploaded file
                              example:
                                phoneNumber: "+1234567890"
                                name: "John Doe"
                                email: "john@example.com"
                      totalCount:
                        type: integer
                        description: Total number of members in the audience
                        example: 150
                      totalPages:
                        type: integer
                        description: Total number of pages available
                        example: 15
                      hasMore:
                        type: boolean
                        description: Whether there are more pages available
                        example: true
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "error"
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Audience ID is required"]
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Failed to fetch audience members"]

    post:
      summary: Add audience members
      description: Add new members to an existing audience. Users can only add members to audiences they created.
      tags:
        - Audience
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the audience
          schema:
            type: string
            example: "60d0fe4f5311236168a109ca"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                members:
                  type: array
                  description: Array of member objects with dynamic structure based on audience configuration
                  items:
                    type: object
                    description: Member data with keys matching the audience's CSV structure. Must include the phone number column.
                    example:
                      phoneNumber: "+1234567890"
                      name: "John Doe"
                      email: "john@example.com"
              required:
                - members
      responses:
        "200":
          description: Members added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        message:
                          type: string
                          example: "5 members added successfully"
                        data:
                          type: object
                          properties:
                            added:
                              type: integer
                              description: Number of members successfully added
                              example: 5
                            skipped:
                              type: integer
                              description: Number of members skipped (e.g., duplicates)
                              example: 2
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                      [
                        "Each member must have a phoneNumber field",
                        "Cannot add 15 members. You currently have 9990 members in this audience. The maximum limit is 10000 members. You can add up to 10 more members.",
                      ]
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "403":
          description: Forbidden - User can only modify audiences they created
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Not authorized to modify this audience"]
        "404":
          description: Audience not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Audience not found"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

    delete:
      summary: Delete audience members
      description: Remove specific members from an audience by their member IDs. Users can only delete members from audiences they created.
      tags:
        - Audience
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the audience
          schema:
            type: string
            example: "60d0fe4f5311236168a109ca"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                memberIds:
                  type: array
                  description: Array of member IDs to delete
                  items:
                    type: string
                    example: "60d0fe4f5311236168a109cd"
              required:
                - memberIds
      responses:
        "200":
          description: Members deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      deletedCount:
                        type: integer
                        description: Number of members successfully deleted
                        example: 3
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Audience ID missing"]
        "401":
          $ref: "#/components/responses/UnauthorizedErrorResponse"
        "403":
          description: Forbidden - User can only modify audiences they created
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Not authorized to modify this audience"]
        "404":
          description: Audience not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Audience not found"]
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"

  /audience/{id}/members/search:
    get:
      summary: Search audience members
      description: |
        Search for members within a specific audience using flexible search parameters. Users can only search members of audiences they created.

        **Search Types:**
        - **General Search** (`query`): Searches across all fields in the audience member data
        - **Field-Specific Search**: Use any field name as a parameter (e.g., `firstName=john`, `phoneNumber=123456`, `email=test@example.com`)

        **Examples:**
        - `?query=john` - General search across all fields
        - `?firstName=john` - Search specifically in firstName field
        - `?phoneNumber=555-1234` - Search specifically in phoneNumber field
        - `?firstName=john&lastName=doe` - Search for members matching both criteria

        **Note:** When using phoneNumber field, do not use quotes around the phone number. You can use either a general search OR field-specific searches, but not both simultaneously.
      tags:
        - Audience
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the audience
          schema:
            type: string
            example: "60d0fe4f5311236168a109ca"
        - name: query
          in: query
          required: false
          description: General search term that searches across all fields in audience member data
          schema:
            type: string
            example: "john"
        - name: "*"
          in: query
          required: false
          description: |
            Any field name can be used as a query parameter for field-specific searches.
            Examples: firstName, lastName, phoneNumber, email, etc.
            The parameter name becomes the field to search in, and the value is the search term.
            When using phoneNumber field, do not use quotes around the phone number.
          schema:
            type: string
            example: "field_value"
      responses:
        "200":
          description: Search results returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      members:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              description: The unique identifier for the audience member
                              example: "60d0fe4f5311236168a109cd"
                            data:
                              type: object
                              description: Dynamic data from CSV, structure depends on uploaded file
                              example:
                                phoneNumber: "+1234567890"
                                name: "John Doe"
                                email: "john@example.com"
                      searchInfo:
                        type: object
                        description: Information about the search performed
                        properties:
                          searchType:
                            type: string
                            description: The type of search performed
                            enum: ["general", "field"]
                            example: "field"
                          searchTerm:
                            type: string
                            description: The search term(s) used
                            example: "john"
                          searchFields:
                            type: array
                            items:
                              type: string
                            description: The specific fields searched (for field-specific searches)
                            example: ["firstName", "lastName"]
                          totalResults:
                            type: integer
                            description: The number of results returned
                            example: 5
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example:
                      [
                        "At least one search parameter is required. Use 'query' for general search across all fields, or use field-specific searches like 'firstName=john' or 'phoneNumber=123456'.",
                      ]
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Failed to search audience members"]

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ApiResponse:
      type: object
      properties:
        status:
          type: boolean
        data:
          type: object
    UnauthorizedErrorResponse:
      type: object
      properties:
        status:
          type: boolean
          example: false
        errors:
          type: array
          items:
            type: string
          example: ["Unauthorized: User not found"]
    InternalServerErrorResponse:
      type: object
      properties:
        status:
          type: boolean
          example: false
        errors:
          type: array
          items:
            type: string
          example: ["Internal server error"]
    BadRequestErrorResponse:
      type: object
      properties:
        status:
          type: boolean
          example: false
        errors:
          type: array
          items:
            type: string
          example: ["Invalid input"]

    CreateAgentFromTemplateRequest:
      type: object
      required:
        - agentName
        - templateId
      properties:
        agentName:
          type: string
          description: Name of the agent
        agentDescription:
          type: string
          description: Description of the agent
        templateId:
          type: string
          description: ID of the template to use. You can get the list of templates with their description and id from the /agent/template endpoint.
    CreateAgentRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        description:
          type: string
        backgroundSound:
          type: string
          enum: ["", "office", "cafe", "call_center", "static"]
          default: ""
          description: "Ambient background sound during calls. Options: '' (none), 'office', 'cafe', 'call_center', 'static'."
        # visibleToEveryone:
        #   type: boolean
        #   default: false
        language:
          type: object
          description: Language configuration for the agent. You can enable or disable language switching for the agent. This will be used to determine the language of the agent.
          properties:
            enabled:
              type: string
              enum: [en, hi, ta]
              description: "The language of the agent. Supported: 'en' (English), 'hi' (Hindi), 'ta' (Tamil)."
              default: en
            switching:
              type: object
              description: Language switching configuration for the agent. If enabled, the agent will be able to switch between languages based on the user's language.
              properties:
                isEnabled:
                  type: boolean
                  description: Whether to enable language switching for the agent
                  default: false
                minWordsForDetection:
                  type: number
                  minimum: 1
                  maximum: 10
                  description: Minimum number of words required for language detection
                  default: 2
                strongSignalThreshold:
                  type: number
                  minimum: 0.1
                  maximum: 0.9
                  description: Threshold for strong language signal detection (0.1 to 0.9)
                  default: 0.7
                weakSignalThreshold:
                  type: number
                  minimum: 0.1
                  maximum: 0.9
                  description: Threshold for weak language signal detection (0.1 to 0.9)
                  default: 0.3
                minConsecutiveForWeakThresholdSwitch:
                  type: number
                  minimum: 1
                  maximum: 5
                  description: Minimum consecutive detections required for weak threshold language switch
                  default: 2
        synthesizer:
          type: object
          description: Synthesizer configuration for the agent. You can configure the synthesizer to use different voices and models. Currently we support 3 types of models for the synthesizer. Waves, Waves Lightning Large and Waves Lightning Large Voice Clone. You can clone your voice using waves platform https://waves.smallest.ai/voice-clone and use the voiceId for this field and select the model as waves_lightning_large_voice_clone to use your cloned voice. When updating the synthesizer configuration to voice clone model, you have to provide model and voiceId and gender all are required fields but when selecting the model as waves or waves and waves_lightning_large, you have to provide only model field and voiceId.
          properties:
            voiceConfig:
              oneOf:
                - type: object
                  properties:
                    model:
                      type: string
                      enum: [waves_lightning_large_voice_clone]
                      description: We currently support 3 types of models for the synthesizer. Waves, Waves Lightning Large and Waves Lightning Large Voice Clone. You can clone your voice using waves platform and use the voiceId for this field and select the model as waves_lightning_large_voice_clone to use your cloned voice.
                    voiceId:
                      type: string
                    gender:
                      type: string
                      enum:
                        - male
                        - female
                      description: The gender of the synthesizer. When selecting gender, you have to select the model and voiceId which are required fields.
                - type: object
                  properties:
                    model:
                      type: string
                      enum: [waves, waves_lightning_large]
                      description: We currently support 3 types of models for the synthesizer. Waves, Waves Lightning Large and Waves Lightning Large Voice Clone. You can clone your voice using waves platform and use the voiceId for this field and select the model as waves_lightning_large_voice_clone to use your cloned voice.
                    voiceId:
                      type: string
                      default: nyah
                      description: The voice ID to use
              default:
                model: waves_lightning_large
                voiceId: nyah
            speed:
              type: number
              default: 1.2
            consistency:
              type: number
              minimum: 0
              maximum: 1
              default: 0.5
            similarity:
              type: number
              minimum: 0
              maximum: 1
              default: 0
            enhancement:
              type: number
              enum: [0, 1, 2]
              default: 1
        globalKnowledgeBaseId:
          type: string
          description: The global knowledge base ID of the agent. You can create a global knowledge base by using the /knowledgebase endpoint and assign it to the agent. The agent will use this knowledge base for its responses.
        slmModel:
          type: string
          enum: ["electron", "gpt-4o"]
          default: "electron"
          description: The LLM model to use for the agent. LLM model will be used to generate the response and take decisions based on the user's query.
        defaultVariables:
          type: object
          description: The default variables to use for the agent. These variables will be used if no variables are provided when initiating a conversation with the agent.
        globalPrompt:
          type: string
          description: |
            Set global instructions for your agent's personality, role, and behavior throughout conversations. 
            Note: Only used for workflow_graph agents.
        telephonyProductId:
          type: string
          description: The telephony product ID of the agent. This is the product ID of the telephony product that will be used to make the outbound call. You can buy telephone number and assign it to the agent.
        workflowType:
          $ref: "#/components/schemas/WorkflowType"
          default: workflow_graph
          description: The type of workflow to create for the agent. Defaults to workflow_graph if not specified.

    UpdateAgentRequest:
      $ref: "#/components/schemas/CreateAgentRequest"

    AgentDTO:
      type: object
      properties:
        _id:
          type: string
          description: The ID of the agent
        name:
          type: string
          description: The name of the agent
        description:
          type: string
          description: The description of the agent
        backgroundSound:
          type: string
          enum: ["", "office", "cafe", "call_center", "static"]
          description: "Ambient background sound during calls. Options: '' (none), 'office', 'cafe', 'call_center', 'static'."
        organization:
          type: string
          description: The organization ID of the agent
        workflowId:
          type: string
          description: The workflow ID of the agent
        workflowType:
          $ref: "#/components/schemas/WorkflowType"
          default: workflow_graph
          description: The type of workflow used by the agent
        createdBy:
          type: string
          description: The user ID of the user who created the agent
        globalKnowledgeBaseId:
          type: string
          description: The global knowledge base ID of the agent
        language:
          type: object
          description: The language configuration of the agent
          properties:
            enabled:
              type: string
              description: The language of the agent
              enum: [en, hi, ta]
            switching:
              type: object
              description: Language switching configuration for the agent
              properties:
                isEnabled:
                  type: boolean
                  description: Whether language switching is enabled for the agent
                minWordsForDetection:
                  type: number
                  description: Minimum number of words required for language detection
                strongSignalThreshold:
                  type: number
                  description: Threshold for strong language signal detection
                weakSignalThreshold:
                  type: number
                  description: Threshold for weak language signal detection
                minConsecutiveForWeakThresholdSwitch:
                  type: number
                  description: Minimum consecutive detections required for weak threshold language switch
            supported:
              type: array
              items:
                type: string
              description: The supported languages of the agent
        synthesizer:
          type: object
          description: The synthesizer (TTS) configuration of the agent
          properties:
            voiceConfig:
              type: object
              description: The voice configuration of the synthesizer
              properties:
                model:
                  type: string
                  description: The model of the synthesizer
                  enum:
                    - waves
                    - waves_lightning_large
                    - waves_lightning_large_voice_clone
                  default: waves_lightning_large
                voiceId:
                  type: string
                  description: The voice ID of the synthesizer.
                  default: nyah
                gender:
                  type: string
                  enum:
                    - male
                    - female
                  default: female
            speed:
              type: number
              default: 1.2
              description: The speed of the synthesizer
            consistency:
              type: number
              default: 0.5
              description: The consistency of the synthesizer
            similarity:
              type: number
              default: 0
              description: The similarity of the synthesizer
            enhancement:
              type: number
              default: 1
              description: The enhancement of the synthesizer
        slmModel:
          type: string
          enum:
            - electron
            - gpt-4o
          description: The LLM model to use for the agent. LLM model will be used to generate the response and take decisions based on the user's query.
        defaultVariables:
          type: object
          description: The default variables to use for the agent. These variables will be used if no variables are provided when initiating a conversation with the agent.
        createdAt:
          type: string
          format: date-time
          description: The date and time when the agent was created
        updatedAt:
          type: string
          format: date-time
          description: The date and time when the agent was last updated

    WebhookAgent:
      type: object
      properties:
        _id:
          type: string
          description: The ID of the agent
        name:
          type: string
          description: The name of the agent
        description:
          type: string
          description: The description of the agent

    WebhookSubscriptionPopulated:
      type: object
      properties:
        _id:
          type: string
          description: The unique identifier for the subscription
        webhookId:
          type: string
          description: The ID of the webhook
        agentId:
          $ref: "#/components/schemas/WebhookAgent"
          nullable: true
          description: The populated agent details, or null if not assigned
        eventType:
          type: string
          enum: [pre-conversation, post-conversation]
          description: The type of event subscribed to
        createdAt:
          type: string
          format: date-time
          description: The date and time when the subscription was created
        updatedAt:
          type: string
          format: date-time
          description: The date and time when the subscription was last updated

    Webhook:
      type: object
      properties:
        _id:
          type: string
          description: The unique identifier for the webhook
        url:
          type: string
          description: The webhook endpoint URL
        description:
          type: string
          description: The description of the webhook
        status:
          type: string
          enum: [enabled, disabled]
          description: The status of the webhook
        organizationId:
          type: string
          description: The organization ID
        createdBy:
          type: string
          description: The user ID who created the webhook
        subscriptions:
          type: array
          items:
            $ref: "#/components/schemas/WebhookSubscriptionPopulated"
          description: A list of subscriptions for the webhook with populated agent details.
        decryptedSecretKey:
          type: string
          description: The decrypted signing secret for the webhook. This is only returned when fetching a single webhook by ID.
        createdAt:
          type: string
          format: date-time
          description: The date and time when the webhook was created
        updatedAt:
          type: string
          format: date-time
          description: The date and time when the webhook was last updated

    WebhookSubscription:
      type: object
      properties:
        _id:
          type: string
          description: The unique identifier for the subscription
        webhookId:
          type: string
          description: The ID of the webhook
        agentId:
          type: string
          description: The ID of the agent
        eventType:
          type: string
          enum: [pre-conversation, post-conversation]
          description: The type of event subscribed to
        createdAt:
          type: string
          format: date-time
          description: The date and time when the subscription was created
        updatedAt:
          type: string
          format: date-time
          description: The date and time when the subscription was last updated

    KnowledgeBase:
      type: object
      properties:
        _id:
          type: string
          description: The unique identifier for the knowledge base
        name:
          type: string
          description: The name of the knowledge base
        description:
          type: string
          description: The description of the knowledge base
        organization:
          type: string
          description: The organization ID
        createdBy:
          type: string
          description: The user ID who created the knowledge base
        createdAt:
          type: string
          format: date-time
          description: The date and time when the knowledge base was created
        updatedAt:
          type: string
          format: date-time
          description: The date and time when the knowledge base was last updated
      required:
        - _id
        - name
        - organization
        - createdBy

    KnowledgeBaseItem:
      type: object
      properties:
        _id:
          type: string
          description: The unique identifier for the knowledge base item
        itemType:
          type: string
          enum: [file, text]
          description: The type of the knowledge base item
        metadata:
          type: object
          description: Additional metadata for the item
        knowledgeBaseId:
          type: string
          description: The ID of the knowledge base this item belongs to
        processingStatus:
          type: string
          enum: [pending, processing, completed, failed]
          description: The processing status of the item
        fileName:
          type: string
          description: The name of the file (for file type items)
        contentType:
          type: string
          description: The MIME type of the content
        size:
          type: number
          description: The size of the file in bytes
        key:
          type: string
          description: The storage key for the file
        title:
          type: string
          description: The title of the item
        content:
          type: string
          description: The content of the item (for text type items)
        createdAt:
          type: string
          format: date-time
          description: The date and time when the item was created
        updatedAt:
          type: string
          format: date-time
          description: The date and time when the item was last updated
      required:
        - _id
        - itemType
        - knowledgeBaseId
        - processingStatus
        - createdAt
        - updatedAt

    WebhookEvent:
      type: object
      properties:
        _id:
          type: string
          description: The unique identifier for the event
        webhookId:
          type: string
          description: The ID of the webhook
        eventType:
          type: string
          description: The type of event
        payload:
          type: object
          description: The event payload
        status:
          type: string
          description: The status of the event
        createdAt:
          type: string
          format: date-time
          description: The date and time when the event was created

    WorkflowType:
      type: string
      enum: [workflow_graph, single_prompt]
      description: The type of workflow configuration. workflow_graph uses a node-based visual workflow, single_prompt uses a simple prompt-based configuration.

    WorkflowGraphData:
      type: object
      description: Workflow configuration using a node-based graph structure
      properties:
        nodes:
          type: array
          description: Array of workflow nodes
          items:
            type: object
            properties:
              id:
                type: string
                description: Unique identifier for the node
              type:
                type: string
                description: Type of the node (e.g., default_node, end_call, pre_call_api)
              position:
                type: object
                properties:
                  x:
                    type: number
                  y:
                    type: number
              data:
                type: object
                description: Node-specific data and configuration
        edges:
          type: array
          description: Array of workflow edges connecting nodes
          items:
            type: object
            properties:
              id:
                type: string
                description: Unique identifier for the edge
              source:
                type: string
                description: ID of the source node
              target:
                type: string
                description: ID of the target node
              type:
                type: string
                description: Type of the edge

    SinglePromptData:
      type: object
      description: Workflow configuration using a simple prompt-based approach
      properties:
        prompt:
          type: string
          description: The main prompt that defines the agent's behavior and responses
        tools:
          type: array
          description: Array of tools/functions available to the agent
          items:
            type: object
            description: Tool configuration object

    SinglePromptConfig:
      type: object
      description: Configuration for single prompt workflow type
      properties:
        prompt:
          type: string
          description: The main prompt that defines the agent's behavior and responses
          example: "You are a helpful AI assistant that can help users with various tasks."
        tools:
          type: array
          description: Array of tools/functions available to the agent during conversations
          items:
            type: object
            properties:
              type:
                type: string
                enum: [end_call, transfer_call, api_call, extract_dynamic_variables, knowledge_base_search]
                description: The type of function/tool
              name:
                type: string
                description: Unique name for the function
                example: "end_conversation"
              description:
                type: string
                description: Description of what the function does
                example: "End the conversation when the user is satisfied"
              # API Call specific fields
              url:
                type: string
                format: uri
                description: "Required for api_call type. The URL to make the HTTP request to"
                example: "https://api.example.com/data"
              method:
                type: string
                enum: [GET, POST, PUT, DELETE, PATCH]
                description: "Required for api_call type. HTTP method to use"
                example: "POST"
              timeout:
                type: integer
                minimum: 1000
                maximum: 30000
                description: "Optional for api_call type. Request timeout in milliseconds (1000-30000)"
                example: 5000
              headers:
                type: array
                description: "Optional for api_call type. HTTP headers to include in the request"
                items:
                  type: object
                  properties:
                    key:
                      type: string
                      example: "Authorization"
                    value:
                      type: string
                      example: "Bearer token123"
                  required: [key, value]
              queryParams:
                type: array
                description: "Optional for api_call type. Query parameters to include in the request"
                items:
                  type: object
                  properties:
                    key:
                      type: string
                      example: "limit"
                    value:
                      type: string
                      example: "10"
                  required: [key, value]
              requestBodySchema:
                type: object
                description: "Optional for api_call type. Schema defining the structure of the request body"
                properties:
                  type:
                    type: string
                    enum: [object]
                  properties:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        type:
                          type: string
                          enum: [string, number, boolean, array]
                        description:
                          type: string
                        enum:
                          type: array
                          items:
                            type: string
                      required: [type, description]
                  required:
                    type: array
                    items:
                      type: string
                required: [type, properties, required]
              responseVariables:
                type: array
                description: "Optional for api_call type. Variables to extract from the API response"
                items:
                  type: object
                  properties:
                    variableName:
                      type: string
                      description: "Name of the variable to store the extracted value"
                      example: "userId"
                    jsonPath:
                      type: string
                      description: "JSON path to extract the value from response"
                      example: "$.data.user.id"
                  required: [variableName, jsonPath]
              # Transfer Call specific fields
              transferNumber:
                type: string
                description: "Required for transfer_call type. Phone number to transfer the call to"
                example: "+1234567890"
              # Dynamic Variable Extraction specific fields
              variables:
                type: array
                description: "Optional for extract_dynamic_variables type. Legacy field, use variablesExtractionSchema instead"
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    description:
                      type: string
                    type:
                      type: string
                      enum: [text, number, boolean, enum]
                    values:
                      type: array
                      items:
                        type: string
                  required: [name, description, type]
              variablesExtractionSchema:
                type: array
                description: "Required for extract_dynamic_variables type. Schema defining variables to extract from conversation"
                items:
                  type: object
                  properties:
                    name:
                      type: string
                      description: "Name of the variable to extract"
                      example: "customerName"
                    description:
                      type: string
                      description: "Description of what this variable represents"
                      example: "The customer's full name"
                    type:
                      type: string
                      enum: [text, number, boolean, enum]
                      description: "Data type of the variable"
                    values:
                      type: array
                      items:
                        type: string
                      description: "Required when type is 'enum'. List of possible values"
                      example: ["satisfied", "unsatisfied", "neutral"]
                  required: [name, description, type]
              # Knowledge Base Search specific fields
              knowledgeBaseId:
                type: string
                description: "Required for knowledge_base_search type. ID of the knowledge base to search"
                example: "60d0fe4f5311236168a109ca"
              fillerPhrases:
                type: array
                description: "Optional for knowledge_base_search type. Phrases to use while searching"
                items:
                  type: string
                example: ["Let me check that for you", "One moment please"]
            required: [type, name, description]
            # Conditional validation based on type would be handled by the backend
          default: []
      required: [prompt]
  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ApiResponse"

    BadRequestError:
      description: Invalid input
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BadRequestErrorResponse"

    ForbiddenError:
      description: Forbidden access
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ApiResponse"

    UnauthorizedErrorResponse:
      description: Unauthorized access
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UnauthorizedErrorResponse"

    InternalServerErrorResponse:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/InternalServerErrorResponse"

tags:
  - name: Agent Templates
    description: Operations related to agent templates
  - name: Agents
    description: Operations related to agents
  - name: Workflows
    description: Operations related to workflow configuration and management
  - name: Logs
    description: Operations related to conversation logs, call history, and recordings. Supports filtering by agents, campaigns, call IDs, status, duration, and more.
  - name: Calls
    description: Operations related to initiating and managing calls
  - name: Phone Numbers
    description: Operations related to phone numbers
  - name: Webhooks
    description: Operations related to webhooks and webhook subscriptions
  - name: Audience
    description: Operations related to audience management and CSV uploads

servers:
  - url: https://atoms-api.smallest.ai/api/v1
    description: Production server
